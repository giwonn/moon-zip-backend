generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "postgresql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

model User {
  id        String    @id(map: "user_pk") @default(uuid()) @db.Uuid
  email     String    @unique(map: "email_uk") @db.VarChar(50)
  macId     String    @map("mac_id") @db.VarChar(100)
  nickName  String?   @map("nickname") @db.VarChar(20)
  imageUrl  String?   @map("image_url") @db.VarChar
  createdAt DateTime  @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt DateTime  @default(now()) @map("updated_at") @db.Timestamp(6)
  deletedAt DateTime? @map("deleted_at") @db.Timestamp(6)

  socialUser SocialUser[]

  @@map("user")
}

model SocialUser {
  userId String @map("user_id") @db.Uuid
  type   String @db.VarChar(20)
  id     String @map("id") @db.VarChar(100)

  user User @relation(fields: [userId], references: [id])

  @@id([userId, type, id], map: "social_user_pk")
  @@unique([userId, type])
  @@index([userId])
  @@map("social_user")
}

model Library {
  id          String        @id(map: "library_pk") @default(uuid()) @db.Uuid
  userId      String        @map("user_id") @db.Uuid
  createdAt   DateTime      @default(now()) @map("created_at") @db.Timestamp(6)
  deletedAt   DateTime?     @map("deleted_at") @db.Timestamp(6)
  libraryBook LibraryBook[]

  @@map("library")
}

model Book {
  id           String    @id(map: "book_pk") @db.VarChar(100)
  title        String?   @db.VarChar
  contents     String?   @db.VarChar(1000)
  url          String?   @db.VarChar
  authors      String[]  @default([]) @db.VarChar
  translators  String[]  @default([]) @db.VarChar
  publisher    String?   @db.VarChar
  price        Int?
  salePrice    Int?      @map("sale_price")
  thumbnailUrl String?   @map("thumbnail_url") @db.VarChar(200)
  status       String?   @db.VarChar(20)
  publishDate  DateTime? @map("publish_date") @db.Timestamp(6)

  libraryBook LibraryBook[]

  @@map("book")
}

model LibraryBook {
  id        String @id(map: "library_book_pk") @default(uuid()) @db.Uuid
  libraryId String @map("library_id") @db.Uuid
  bookId    String @map("book_id") @db.VarChar(100)

  library  Library    @relation(fields: [libraryId], references: [id])
  book     Book       @relation(fields: [bookId], references: [id])
  Sentence Sentence[]

  @@unique([libraryId, bookId])
  @@index(libraryId)
  @@index(bookId)
  @@map("library_book")
}

model Sentence {
  id            String    @id(map: "sentence_pk") @default(uuid()) @db.Uuid
  libraryBookId String    @map("library_book_id") @db.Uuid
  content       String    @db.VarChar(200)
  createdAt     DateTime  @default(now()) @map("created_at") @db.Timestamp(6)
  deletedAt     DateTime? @map("deleted_at") @db.Timestamp(6)

  libraryBook LibraryBook   @relation(fields: [libraryBookId], references: [id])
  SentenceTag SentenceTag[]

  @@index(libraryBookId)
  @@map("sentence")
}

model Tag {
  name      String    @id(map: "tag_pk") @db.VarChar(50)
  createdAt DateTime  @default(now()) @map("created_at") @db.Timestamp(6)
  deletedAt DateTime? @map("deleted_at") @db.Timestamp(6)

  sentenceTag SentenceTag[]

  @@map("tag")
}

model SentenceTag {
  sentenceId String @map("sentence_id") @db.Uuid
  tagName    String @map("tag_name")

  sentence Sentence @relation(fields: [sentenceId], references: [id])
  tag      Tag      @relation(fields: [tagName], references: [name])

  @@id([sentenceId, tagName])
  @@index(sentenceId)
  @@index(tagName)
  @@map("sentence_tag")
}
